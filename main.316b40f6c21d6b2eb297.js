(()=>{"use strict";var t,e=function(){function t(t){var e=t.length,r=t.direction;this.length=e,this.direction=r,this.hitList=new Array(e).fill(!1)}return t.prototype.hit=function(t){this.hitList[t]=!0},t.prototype.isHit=function(t){return this.hitList[t]},t.prototype.isSunk=function(){for(var t=0,e=this.hitList;t<e.length;t++)if(!e[t])return!1;return!0},t}(),r=function(){function t(){this.BattleshipCols=10,this.BattleshipRows=10,this.finalBoard=new Array(10).fill(!1).map((function(){return Array(10).fill(!1)})),this.shipCount=0}return t.prototype.checkValidPlacement=function(t,e,r,i){var n=e+i;return 1===r&&t+i<=this.BattleshipCols&&e<this.BattleshipRows||2===r&&n<=this.BattleshipRows&&t<this.BattleshipCols},t.prototype.traverseBoard=function(t,e,r,i){var n=0;if(1===r)for(;n<=i;){if(t-n<0||"boolean"==typeof this.finalBoard[t-n][e])return n-1;n+=1}else if(2===r)for(;n<=i;){if(e-n<0||"boolean"==typeof this.finalBoard[t][e-n])return n-1;n+=1}return-1},t.prototype.checkBoard=function(t,e){return this.finalBoard[t][e]},t.prototype.checkSpotHit=function(t,e){var r=this.checkBoard(t,e);return this.traverseBoard(t,e,r.direction,r.length)},t.prototype.checkSpotHitBool=function(t,e){var r=this.checkSpotHit(t,e);return this.checkBoard(t,e).isHit(r)},t.prototype.checkAllSunk=function(){for(var t=0,e=0;e<this.finalBoard[0].length;e++)for(var r=0;r<this.finalBoard.length;r++){var i=this.checkBoard(e,r);"boolean"!=typeof i&&i.isSunk()&&0===this.checkSpotHit(e,r)&&(t+=1)}return t===this.shipCount},t.prototype.placeShip=function(t,r,i,n){var o=new e({length:n,direction:i});if(1===i&&this.checkValidPlacement(t,r,i,n)){for(var a=0;a<n;a++)this.finalBoard[t+a][r]=o;this.shipCount+=1}else{if(2!==i||!this.checkValidPlacement(t,r,i,n))return!1;for(a=0;a<n;a++)this.finalBoard[t][r+a]=o;this.shipCount+=1}return!0},t.prototype.receiveAttack=function(t,e){if(t>=this.BattleshipCols||e>=this.BattleshipRows)return!1;var r=this.checkBoard(t,e);if("boolean"!=typeof r){var i=this.traverseBoard(t,e,r.direction,r.length);return r.hit(i),!0}return this.finalBoard[t][e]=!0,!1},t}(),i=(t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}),n=function(){function t(t,e,r){this.name=t,this.isTurn=e,this.currentBoard=r,this.isWinner=!1}return t.prototype._toggleTurn=function(){this.isTurn=!this.isTurn},t.prototype.hasLost=function(){return this.currentBoard.checkAllSunk()},t.prototype.win=function(){this.isWinner=!0},t.prototype.receiveAttack=function(t,e){var r=this.currentBoard.receiveAttack(t,e);return this._toggleTurn(),r},t.prototype.attackPlayer=function(t,e,r){return t.receiveAttack(e,r)},t}(),o=function(t){function e(e){var r=t.call(this,"Robot",!1,e)||this;return r.moveList=new Set,r.placeList=new Set,r}return i(e,t),e.prototype.getRandInt=function(){return Math.floor(10*Math.random())},e.prototype.checkMove=function(t,e){return!this.moveList.has([t,e])&&(this.moveList.add([t,e]),!0)},e.prototype.checkShip=function(t,e,r,i){if(2===r&&e+i<this.currentBoard.BattleshipRows){for(var n=e;n<e+i;n++)if("boolean"!=typeof this.currentBoard.checkBoard(t,n)||this.placeList.has([t,n]))return!1;for(n=e;n<e+i;n++)this.placeList.add([t,n])}else{if(!(1===r&&t+i<this.currentBoard.BattleshipCols))return!1;for(n=t;n<t+i;n++)if("boolean"!=typeof this.currentBoard.checkBoard(n,e)||this.placeList.has([n,e]))return!1;for(n=t;n<t+i;n++)this.placeList.add([n,e])}return!0},e.prototype.getValidShip=function(t){for(var e=Math.floor(2*Math.random())+1,r=this.getRandInt(),i=this.getRandInt(),n=this.checkShip(r,i,e,t);!n;)r=this.getRandInt(),i=this.getRandInt(),n=this.checkShip(r,i,e,t);return[e,r,i]},e.prototype.placeShip=function(t){var e=this.getValidShip(t),r=e[0],i=e[1],n=e[2];return this.currentBoard.placeShip(i,n,r,t)},e.prototype.attackPlayer=function(e){for(var r,i=[this.getRandInt(),this.getRandInt()],n=i[0],o=i[1],a=this.checkMove(n,o);!a;)n=(r=[this.getRandInt(),this.getRandInt()])[0],o=r[1],a=this.checkMove(n,o);return t.prototype.attackPlayer.call(this,e,n,o)},e}(n),a=function(){function t(){this.playerOneBoard=new r,this.playerTwoBoard=new r,this.playerOne=new n("",!0,this.playerOneBoard),this.playerTwo=new o(this.playerTwoBoard),this.observers=[],this.stage=1}return t.prototype.addObservers=function(t){this.observers=t},t.prototype.updateObservers=function(){for(var t=0,e=this.observers;t<e.length;t++)e[t].updateView(this)},t.prototype.updateObserver=function(t){t.updateView(this)},t.prototype.yourTurn=function(){return this.playerOne.isTurn},t.prototype.setName=function(t){this.playerOne.name=t},t.prototype.yourSetup=function(t,e,r,i){this.playerOne.currentBoard.placeShip(t,e,r,i)},t.prototype.checkWin=function(){return this.playerTwo.hasLost()?1:this.playerOne.hasLost()?2:0},t.prototype.robotSetup=function(){this.playerTwo.placeShip(2),this.playerTwo.placeShip(3),this.playerTwo.placeShip(3),this.playerTwo.placeShip(4),this.playerTwo.placeShip(5)},t.prototype.yourPlay=function(t,e){this.playerOne.attackPlayer(this.playerTwo,t,e)},t.prototype.robotPlay=function(){this.playerTwo.attackPlayer(this.playerOne)},t.prototype.playerBoard=function(){return this.playerOne.currentBoard},t.prototype.enemyBoard=function(){return this.playerTwo.currentBoard},t.prototype.reset=function(){this.playerOneBoard=new r,this.playerTwoBoard=new r,this.playerOne=new n("",!0,this.playerOneBoard),this.playerTwo=new o(this.playerTwoBoard),this.stage=1,this.robotSetup(),this.updateObservers()},t}(),s=function(){function t(t){this.model=t,this.model.robotSetup()}return t.prototype.getAttacked=function(t,e){if(this.model.yourPlay(t,e),console.log(this.model.checkWin(),"winner"),1===this.model.checkWin())return this.model.stage=4,void this.model.updateObservers();this.model.robotPlay(),2===this.model.checkWin()&&(this.model.stage=4),this.model.updateObservers()},t}(),c=function(){function t(t){this.model=t}return t.prototype.placeShip=function(t,e,r,i){this.model.yourSetup(t,e,r,i),this.model.updateObservers()},t}(),l=function(){function t(t){this.model=t}return t.prototype.startGame=function(t){var e=t;null!=t&&""!==t||(e="Player"),console.log(e),this.model.setName(e),this.model.stage=2,this.model.updateObservers()},t}(),h=function(){function t(t){this.controller=t}return t.prototype.removeView=function(){var t=document.getElementById("start-screen");null==t||t.remove()},t.prototype.startGame=function(t){t.preventDefault();var e=t.target.form[0].value;null!=e&&(this.removeView(),this.controller.startGame(e))},t.prototype.buildView=function(){var t=document.getElementById("game-container");null==t||t.remove();var e=document.createElement("div");e.id="game-container";var r=document.createDocumentFragment(),i=document.createElement("div");i.id="start-screen";var n=document.createElement("h1");n.textContent="Battleship";var o=document.createElement("form");o.id="username",o.action="#";var a=document.createElement("input");a.type="text",a.name="player-name",a.id="player-name",a.maxLength=14,a.placeholder="Your Name";var s=document.createElement("input");s.type="submit",s.value="Start",s.id="start-game-button",s.addEventListener("click",this.startGame.bind(this)),o.appendChild(a),o.appendChild(s),i.appendChild(n),i.appendChild(o),r.appendChild(i),e.appendChild(r),document.body.appendChild(e)},t.prototype.updateView=function(t){1===t.stage&&this.buildView()},t}(),p=function(){function t(t){this.controller=t,this.curDirection=1,this.totalShipLength=0}return t.prototype.getNextShipSize=function(){switch(this.totalShipLength){case 0:return 2;case 2:case 5:return 3;case 8:return 4;case 12:return 5;default:return 0}},t.prototype.handleMoves=function(t){switch(this.totalShipLength){case 0:this.curShipLength=2,this.totalShipLength+=2;break;case 2:this.curShipLength=3,this.totalShipLength+=3;break;case 5:this.totalShipLength+=3;break;case 8:this.curShipLength=4,this.totalShipLength+=4;break;case 12:this.curShipLength=5,this.totalShipLength+=5,this.controller.model.stage=3;break;default:return}var e=t.target.id.split("-"),r=parseInt(e[1]),i=r%10,n=Math.floor(r/10);1===this.curDirection&&i+this.curShipLength<=10||2===this.curDirection&&n+this.curShipLength<=10?this.controller.placeShip(i,n,this.curDirection,this.curShipLength):1===this.curDirection&&i-this.curShipLength>=0?this.controller.placeShip(i-this.curShipLength+1,n,this.curDirection,this.curShipLength):2===this.curDirection&&n-this.curShipLength>=0&&this.controller.placeShip(i,n-this.curShipLength+1,this.curDirection,this.curShipLength)},t.prototype.addPreview=function(t){console.log("hovered");var e=t.target.id.split("-"),r=parseInt(e[1]),i=r%10,n=Math.floor(r/10),o=this.getNextShipSize();if(1===this.curDirection&&i+o<=10)for(var a=i;a<i+o;a++)null==(s=document.getElementById("player-".concat(10*n+a)))||s.classList.add("preview");else if(2===this.curDirection&&n+o<=10)for(a=n;a<n+o;a++)null==(s=document.getElementById("player-".concat(10*a+i)))||s.classList.add("preview");else if(1===this.curDirection&&i-o>=0)for(a=i-o+1;a<=i;a++)null==(s=document.getElementById("player-".concat(10*n+a)))||s.classList.add("preview");else if(2===this.curDirection&&n-o>=0)for(a=n-o+1;a<=n;a++){var s;null==(s=document.getElementById("player-".concat(10*a+i)))||s.classList.add("preview")}},t.prototype.removePreview=function(){document.querySelectorAll(".preview").forEach((function(t){t.classList.remove("preview")}))},t.prototype.switchDirection=function(){1===this.curDirection?this.curDirection=2:this.curDirection=1},t.prototype.buildView=function(t){var e=this,r=document.getElementById("player-side");r&&r.remove();var i=t.playerBoard().finalBoard,n=document.querySelector(".dual-board"),o=document.createDocumentFragment(),a=document.createElement("div");a.id="player-side";var s=document.createElement("div");s.className="game-board";for(var c=0;c<t.playerBoard().BattleshipRows;c++){for(var l=0;l<t.playerBoard().BattleshipCols;l++){var h=document.createElement("p");h.classList.add("cell"),h.id="player-".concat(10*c+l),"boolean"==typeof i[l][c]&&!1===i[l][c]?(h.classList.add("unhit-cell"),2===t.stage&&(h.addEventListener("mouseover",this.addPreview.bind(this)),h.addEventListener("mouseout",this.removePreview.bind(this)),h.addEventListener("click",this.handleMoves.bind(this)))):"boolean"==typeof i[l][c]&&!0===i[l][c]?h.classList.add("missed-cell"):t.playerBoard().checkSpotHitBool(l,c)?t.playerBoard().checkBoard(l,c).isSunk()?(h.classList.add("hit-cell"),h.textContent="X"):(h.classList.add("hit-cell"),h.textContent="-"):h.classList.add("hit-cell"),s.appendChild(h)}document.addEventListener("keyup",(function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),console.log(t.code),"Space"===t.code&&e.switchDirection()}))}var p=document.createElement("h1");p.className="player-name",2===t.stage?p.textContent="Place your ships: Length ".concat(this.getNextShipSize()):p.textContent=t.playerOne.name,a.appendChild(s),a.appendChild(p),o.appendChild(a),null==n||n.appendChild(o)},t.prototype.updateView=function(t){2===t.stage&&17===this.totalShipLength&&(this.curDirection=1,this.totalShipLength=0),1!==t.stage&&this.buildView(t)},t}(),d=function(){function t(t){this.controller=t}return t.prototype.handleMoves=function(t){var e=t.target.id.split("-"),r=parseInt(e[1]),i=r%10,n=Math.floor(r/10);this.controller.getAttacked(i,n)},t.prototype.buildView=function(t){var e=document.getElementById("opponent-side");e&&e.remove();var r=t.enemyBoard().finalBoard,i=document.querySelector(".dual-board"),n=document.createDocumentFragment(),o=document.createElement("div");o.id="opponent-side";var a=document.createElement("div");a.className="game-board";for(var s=0;s<t.enemyBoard().BattleshipRows;s++)for(var c=0;c<t.enemyBoard().BattleshipCols;c++){var l=document.createElement("p");l.classList.add("cell"),l.id="enemy-".concat(10*s+c),"boolean"==typeof r[c][s]&&!1===r[c][s]?(l.classList.add("unhit-cell"),3===t.stage&&l.addEventListener("click",this.handleMoves.bind(this))):"boolean"==typeof r[c][s]&&!0===r[c][s]?l.classList.add("missed-cell"):t.enemyBoard().checkSpotHitBool(c,s)?t.enemyBoard().checkBoard(c,s).isSunk()?(l.classList.add("hit-cell"),l.textContent="X"):(l.classList.add("hit-cell"),l.textContent="-"):(3===t.stage&&l.addEventListener("click",this.handleMoves.bind(this)),l.classList.add("unhit-cell")),a.appendChild(l)}var h=document.createElement("h1");h.className="player-name",h.textContent=t.playerTwo.name,o.appendChild(a),o.appendChild(h),n.appendChild(o),null==i||i.appendChild(n)},t.prototype.updateView=function(t){1!==t.stage&&this.buildView(t)},t}(),u=function(){function t(){}return t.prototype.buildView=function(t){var e=document.querySelector(".dual-board");e&&e.remove();var r=document.getElementById("game-container");if(4===t.stage){console.log("winner!!");var i=document.createElement("div");i.className="restart";var n=document.createElement("button"),o=document.createElement("h1");1===t.checkWin()?o.textContent="The winner is ".concat(t.playerOne.name,"!"):o.textContent="The winner is Robot!",n.addEventListener("click",t.reset.bind(t)),n.textContent="Restart",i.appendChild(o),i.appendChild(n),null==r||r.appendChild(i)}var a=document.createElement("div");a.className="dual-board",null==r||r.appendChild(a)},t.prototype.updateView=function(t){1!==t.stage&&this.buildView(t)},t}();new function(t){this.controller=t,this.model=this.controller.model,this.startView=new h(this.controller.startController),this.playerView=new p(this.controller.playerController),this.opponentView=new d(this.controller.opponentController),this.boardView=new u,this.model.addObservers([this.startView,this.boardView,this.playerView,this.opponentView]),this.model.updateObservers()}(new function(t){this.model=t,this.startController=new l(this.model),this.playerController=new c(this.model),this.opponentController=new s(this.model)}(new a))})();
//# sourceMappingURL=main.316b40f6c21d6b2eb297.js.map